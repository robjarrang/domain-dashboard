"use strict";(()=>{var e={};e.id=933,e.ids=[933],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1382:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>D,patchFetch:()=>T,requestAsyncStorage:()=>p,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>y});var a={};r.r(a),r.d(a,{GET:()=>c,POST:()=>m});var s=r(5419),i=r(9108),o=r(9678),n=r(4490),u=r(4908),d=r(8070);function l(e){return e.details?`${e.value} (${e.details})`:e.value}async function c(e){try{let e=await n._.domain.findMany({orderBy:{name:"asc"},include:{esp:!0}});return d.Z.json(e)}catch(e){return d.Z.json({error:"Failed to fetch domains"},{status:500})}}async function m(e){try{let{name:t,dkimSelector:r,espId:a}=await e.json();if(!t||!r)return d.Z.json({error:"Domain name and DKIM selector are required"},{status:400});if(!/^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]$/i.test(t))return d.Z.json({error:"Invalid domain format"},{status:400});if(await n._.domain.findUnique({where:{name:t}}))return d.Z.json({error:"Domain already exists"},{status:400});let[s,i,o]=await Promise.all([(0,u.RT)(t,r),(0,u.Hr)(t),(0,u.Lw)(t)]),c=await n._.domain.create({data:{name:t,dkimSelector:r,dkim:l(s),spf:l(i),dmarc:l(o),espId:a||null},include:{esp:!0}});return d.Z.json(c)}catch(e){return d.Z.json({error:"Failed to create domain"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/domains/route",pathname:"/api/domains",filename:"route",bundlePath:"app/api/domains/route"},resolvedPagePath:"/Users/robmoran/Documents/Email Builds/domain-dashboard/src/app/api/domains/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:v,serverHooks:g,headerHooks:h,staticGenerationBailout:y}=f,D="/api/domains/route";function T(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:v})}},4490:(e,t,r)=>{r.d(t,{_:()=>s});var a=r(3524);let s=global.prisma||new a.PrismaClient},4908:(e,t,r)=>{r.d(t,{RT:()=>i,Lw:()=>n,Hr:()=>o});let a=require("dns");async function s(e){let t=new Promise((e,t)=>{setTimeout(()=>t(Error("DNS lookup timeout")),5e3)});try{return await Promise.race([a.promises.resolveTxt(e),t])}catch(e){if("DNS lookup timeout"===e.message)throw Error("DNS lookup timed out after 5 seconds");throw e}}async function i(e,t){try{let r=(await s(`${t}._domainkey.${e}`)).flat().join(" ");if(!r.includes("v=DKIM1"))return{status:"advisory",value:r,details:"Record found but missing v=DKIM1 tag"};let a=["k=","p="].filter(e=>!r.includes(e));if(a.length>0)return{status:"advisory",value:r,details:`Missing required tags: ${a.join(", ")}`};return{status:"success",value:r}}catch(e){if("ENOTFOUND"===e.code||"ENODATA"===e.code)return{status:"not-configured",value:"",details:"No DKIM record found"};if("ETIMEOUT"===e.code)return{status:"error",value:"",details:"DNS lookup timed out"};return{status:"error",value:"",details:e.message}}}async function o(e){try{let t=(await s(e)).flat().find(e=>e.startsWith("v=spf1"));if(!t)return{status:"not-configured",value:"",details:"No SPF record found"};if(!t.match(/v=spf1( [+-]?(all|include:[^\s]+|ip4:[^\s]+|ip6:[^\s]+|a|mx|ptr|exists:[^\s]+))*( [+-]all)?$/))return{status:"advisory",value:t,details:"Invalid SPF syntax"};return{status:"success",value:t}}catch(e){if("ENOTFOUND"===e.code||"ENODATA"===e.code)return{status:"not-configured",value:"",details:"Domain not found"};if("ETIMEOUT"===e.code)return{status:"error",value:"",details:"DNS lookup timed out"};return{status:"error",value:"",details:e.message}}}async function n(e){try{let t=(await s(`_dmarc.${e}`)).flat().join(" ");if(!t.includes("v=DMARC1"))return{status:"advisory",value:t,details:"Record found but missing v=DMARC1 tag"};let r=["p="].filter(e=>!t.includes(e));if(r.length>0)return{status:"advisory",value:t,details:`Missing required tags: ${r.join(", ")}`};return{status:"success",value:t}}catch(e){if("ENOTFOUND"===e.code||"ENODATA"===e.code)return{status:"not-configured",value:"",details:"No DMARC record found"};if("ETIMEOUT"===e.code)return{status:"error",value:"",details:"DNS lookup timed out"};return{status:"error",value:"",details:e.message}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206],()=>r(1382));module.exports=a})();